# 安装与配置指南

<cite>
**本文档中引用的文件**  
- [PdfTool.csproj](file://PdfTool/PdfTool.csproj)
- [FodyWeavers.xml](file://PdfTool/FodyWeavers.xml)
- [Config.cs](file://PdfTool/Config.cs)
- [MainForm.cs](file://PdfTool/MainForm.cs)
- [MyTools.sln](file://MyTools.sln)
- [packages.config](file://PdfTool/packages.config)
- [PdfHelperLibrary.csproj](file://PdfHelperLibrary/PdfHelperLibrary.csproj)
- [App.config](file://PdfTool/App.config)
</cite>

## 目录
1. [简介](#简介)
2. [获取与安装](#获取与安装)
3. [开发环境要求](#开发环境要求)
4. [从源码构建](#从源码构建)
5. [应用程序配置](#应用程序配置)
6. [FodyWeavers.xml 配置文件说明](#fodyweaversxml-配置文件说明)
7. [常见问题排查](#常见问题排查)
8. [总结](#总结)

## 简介
本指南旨在为首次使用者提供详细的安装与配置说明，帮助用户顺利使用PDF工具。该工具集成了PDF拆分、合并、转图、图片提取、表格提取、文本提取等多种功能，适用于各种PDF处理需求。

## 获取与安装

### 获取编译好的可执行文件
用户可以从项目的发布页面下载预编译的可执行文件。下载完成后，直接运行安装程序即可完成安装。

### 安装步骤
1. 下载安装包
2. 双击安装包启动安装向导
3. 按照提示选择安装路径
4. 等待安装完成
5. 在桌面或开始菜单中找到应用程序并启动

**Section sources**
- [MyTools.sln](file://MyTools.sln#L1-L212)
- [PdfTool.csproj](file://PdfTool/PdfTool.csproj#L1-L204)

## 开发环境要求

### Visual Studio 版本要求
根据解决方案文件 `MyTools.sln` 中的信息，该项目需要 Visual Studio 2022 或更高版本。文件中明确指定了 Visual Studio 版本为 17：

```
# Visual Studio Version 17
VisualStudioVersion = 17.2.32526.322
```

### .NET Framework 要求
项目主要基于 .NET Framework 4.7.2 构建。从多个项目文件中可以看到目标框架版本的设置：

- `PdfTool.csproj`: `<TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>`
- `PdfHelperLibrary.csproj`: `<TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>`
- 其他多个模块也使用 v4.7.2 或 v4.8

**Section sources**
- [MyTools.sln](file://MyTools.sln#L3-L4)
- [PdfTool.csproj](file://PdfTool/PdfTool.csproj#L12)
- [PdfHelperLibrary.csproj](file://PdfHelperLibrary/PdfHelperLibrary.csproj#L11)

## 从源码构建

### 克隆代码库
```bash
git clone https://github.com/username/PdfTool.git
cd PdfTool
```

### 还原 NuGet 包
在构建项目之前，需要先还原所有 NuGet 包。可以通过以下几种方式完成：

#### 使用 Visual Studio
1. 打开 `MyTools.sln` 解决方案文件
2. 右键点击解决方案，选择"还原 NuGet 包"
3. 等待还原过程完成

#### 使用命令行
```bash
# 在解决方案目录下执行
nuget restore MyTools.sln
```

或使用 .NET CLI：
```bash
dotnet restore
```

### 构建项目
1. 打开 Visual Studio 并加载 `MyTools.sln`
2. 选择构建配置（Debug 或 Release）
3. 选择"生成解决方案"

构建成功后，可执行文件将位于 `PdfTool\bin\Debug\` 或 `PdfTool\bin\Release\` 目录下。

**Section sources**
- [packages.config](file://PdfTool/packages.config#L1-L5)
- [PdfTool.csproj](file://PdfTool/PdfTool.csproj#L3-L4)
- [MyTools.sln](file://MyTools.sln#L1-L212)

## 应用程序配置

### 配置文件结构
项目使用标准的 .NET 配置机制，主要配置文件包括：

- `App.config`: 应用程序配置文件
- `Settings.settings`: 用户设置文件
- `Config.cs`: 代码中的常量配置

### Config.cs 配置参数
`Config.cs` 文件定义了应用程序的常量配置：

```csharp
internal static class Config
{
    internal const int ControlMargin = 20;
    internal const int ControlPadding = 12;
}
```

这些配置参数用于控制界面元素的布局间距。

### 应用程序配置文件 (App.config)
`App.config` 文件包含了应用程序的运行时配置，包括：

- 程序集绑定重定向
- 应用程序设置
- 连接字符串

### 用户设置
项目使用 .NET 的 `ApplicationSettingsBase` 机制来存储用户偏好设置。在多个模块的 `Settings.Designer.cs` 文件中可以看到：

```csharp
internal sealed partial class Settings : global::System.Configuration.ApplicationSettingsBase
{
    private static Settings defaultInstance = ((Settings)(global::System.Configuration.ApplicationSettingsBase.Synchronized(new Settings())));
    
    public static Settings Default
    {
        get
        {
            return defaultInstance;
        }
    }
}
```

这些设置会自动保存到用户配置文件中，实现跨会话的持久化。

**Section sources**
- [Config.cs](file://PdfTool/Config.cs#L1-L9)
- [MainForm.cs](file://PdfTool/MainForm.cs#L78-L194)
- [Settings.Designer.cs](file://PdfTool/Properties/Settings.Designer.cs#L1-L30)

## FodyWeavers.xml 配置文件说明

### FodyWeavers.xml 作用
`FodyWeavers.xml` 文件是 Fody 代码织入工具的配置文件，用于在编译时自动修改程序集。在本项目中，该文件配置了 Costura 织入器：

```xml
<Weavers xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="FodyWeavers.xsd">
  <Costura />
</Weavers>
```

### Costura 织入器功能
Costura 织入器的主要功能是将所有依赖的程序集（DLL文件）嵌入到主程序集中，实现单文件部署。这意味着：

1. 所有引用的DLL将被编译进主EXE文件
2. 运行时自动解压并加载这些程序集
3. 无需在部署目录中包含多个DLL文件

### 用户是否需要干预
对于最终用户来说，**不需要**对 `FodyWeavers.xml` 文件进行任何干预。该文件是开发构建过程的一部分，已经正确配置。只有在以下情况下才需要修改：

- 添加新的依赖程序集需要特殊处理
- 需要调整嵌入程序集的策略
- 遇到程序集加载问题需要调试

对于普通使用，保持该文件不变即可。

**Section sources**
- [FodyWeavers.xml](file://PdfTool/FodyWeavers.xml#L1-L3)
- [PdfTool.csproj](file://PdfTool/PdfTool.csproj#L3-L4)
- [packages.config](file://PdfTool/packages.config#L3-L4)

## 常见问题排查

### .NET Framework 缺失
**问题现象**：启动应用程序时提示"无法找到 .NET Framework"或"应用程序无法启动"

**解决方案**：
1. 确认系统是否安装了 .NET Framework 4.7.2 或更高版本
2. 访问 Microsoft 官方网站下载并安装 .NET Framework 4.8
3. 重启计算机后重试

### 依赖库加载失败
**问题现象**：应用程序启动时报错"无法加载文件或程序集"

**可能原因及解决方案**：
1. **NuGet 包未正确还原**：
   - 在 Visual Studio 中右键解决方案，选择"还原 NuGet 包"
   - 或运行 `nuget restore MyTools.sln`

2. **程序集版本冲突**：
   - 检查 `App.config` 中的绑定重定向配置
   - 确保所有引用的程序集版本一致

3. **缺少外部依赖**：
   - 检查项目是否引用了 `_extLibrary` 目录下的外部库
   - 确保 `O2S.Components.PDFRender4NET.dll` 等文件存在

### 构建错误
**常见错误**：这台计算机上缺少此项目引用的 NuGet 程序包

**解决方案**：
1. 确保已安装 NuGet 包管理器
2. 在解决方案目录下运行：
   ```bash
   nuget restore
   ```
3. 或在 Visual Studio 中启用"自动还原 NuGet 包"选项

### 运行时错误
**问题**：应用程序启动后立即崩溃

**排查步骤**：
1. 检查事件查看器中的应用程序日志
2. 确认所有必需的依赖项都已安装
3. 尝试以管理员身份运行
4. 检查防病毒软件是否阻止了程序运行

**Section sources**
- [PdfTool.csproj](file://PdfTool/PdfTool.csproj#L197-L203)
- [PdfHelperLibrary.csproj](file://PdfHelperLibrary/PdfHelperLibrary.csproj#L121-L126)
- [App.config](file://PdfTool/App.config)

## 总结
本指南详细介绍了PDF工具的安装、配置和常见问题解决方法。通过遵循上述步骤，用户可以顺利安装和使用该工具。对于开发者，从源码构建的过程也已详细说明，包括Visual Studio版本要求和NuGet包还原步骤。FodyWeavers.xml配置文件的作用也已解释清楚，用户通常无需对其进行修改。遇到问题时，可以根据提供的排查方法进行解决。

**Section sources**
- [MainForm.cs](file://PdfTool/MainForm.cs#L1-L194)
- [PdfTool.csproj](file://PdfTool/PdfTool.csproj#L1-L204)
- [MyTools.sln](file://MyTools.sln#L1-L212)