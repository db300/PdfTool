# 故障排除

<cite>
**本文档中引用的文件**  
- [Common.cs](file://PdfTool/Common.cs)
- [Config.cs](file://PdfTool/Config.cs)
- [MainForm.cs](file://PdfTool/MainForm.cs)
- [PdfTextExtracter.cs](file://PdfTool/PdfTextExtracter.cs)
- [PdfTableExtracter.cs](file://PdfTool/PdfTableExtracter.cs)
- [PdfSplitter.cs](file://PdfTool/PdfSplitter.cs)
- [PdfMerger.cs](file://PdfTool/PdfMerger.cs)
- [PdfRepairer.cs](file://PdfTool/PdfRepairer.cs)
- [CommonHelper.cs](file://PdfHelperLibrary/CommonHelper.cs)
- [TextExtractHelper.cs](file://PdfHelperLibrary/TextExtractHelper.cs)
- [TableExtractHelper.cs](file://PdfHelperLibrary/TableExtractHelper.cs)
- [SplitHelper.cs](file://PdfHelperLibrary/SplitHelper.cs)
- [MergeHelper.cs](file://PdfHelperLibrary/MergeHelper.cs)
</cite>

## 目录
1. [简介](#简介)
2. [常见问题及解决方案](#常见问题及解决方案)
3. [日志检查与诊断](#日志检查与诊断)
4. [配置文件验证](#配置文件验证)
5. [错误代码详解](#错误代码详解)
6. [修复步骤指南](#修复步骤指南)
7. [附录](#附录)

## 简介
本故障排除指南旨在帮助用户解决在使用PDF工具过程中可能遇到的各种问题。该工具集成了PDF拆分、合并、文本提取、表格提取、图片提取、页面旋转、批量打印、PDF保护、PDF修复和预览等多种功能。通过本指南，用户可以快速识别并解决常见问题，确保工具的稳定运行。

## 常见问题及解决方案

### PDF文件无法打开
当用户尝试打开PDF文件时，可能会遇到无法打开的问题。这通常由文件损坏、路径错误或权限问题引起。

**解决方案：**
1. **检查文件路径**：确保文件路径正确且文件存在。
2. **验证文件完整性**：使用其他PDF阅读器尝试打开文件，确认文件是否损坏。
3. **使用PDF修复器**：在工具中选择“PDF修复”功能，尝试修复损坏的文件。

**Section sources**
- [MainForm.cs](file://PdfTool/MainForm.cs#L41-L58)
- [PdfRepairer.cs](file://PdfTool/PdfRepairer.cs#L34-L55)

### 表格提取结果错乱
在提取PDF中的表格时，可能会出现结果错乱的情况，如数据错位、缺失或格式不正确。

**解决方案：**
1. **检查PDF源文件**：确保PDF中的表格结构清晰，没有复杂的布局或嵌套表格。
2. **调整提取设置**：尝试不同的提取模式或参数，如使用“SpreadsheetExtractionAlgorithm”算法。
3. **手动校正**：对于复杂表格，建议手动校正提取结果。

**Section sources**
- [PdfTableExtracter.cs](file://PdfTool/PdfTableExtracter.cs#L63-L85)
- [TableExtractHelper.cs](file://PdfHelperLibrary/TableExtractHelper.cs#L50-L70)

### 中文乱码
在处理包含中文字符的PDF文件时，可能会出现中文乱码问题。

**解决方案：**
1. **检查编码设置**：确保工具使用的文本编码支持中文字符，如UTF-8。
2. **更新字体**：确保系统中安装了支持中文的字体。
3. **使用正确的提取方法**：确保使用支持中文字符的提取方法，如`TextExtractHelper.ExtractText`。

**Section sources**
- [TextExtractHelper.cs](file://PdfHelperLibrary/TextExtractHelper.cs#L11-L32)
- [PdfTextExtracter.cs](file://PdfTool/PdfTextExtracter.cs#L62-L64)

## 日志检查与诊断

### 日志记录机制
工具使用`CommonHelper`类中的日志记录功能来记录操作过程中的关键信息和错误。日志信息显示在各个功能模块的文本框中，帮助用户了解操作状态和诊断问题。

**日志记录示例：**
```csharp
_txtLog.AppendText($"【页数：{PdfHelperLibrary.CommonHelper.GetPageCount(fileName)}】{fileName}\r\n");
```

**Section sources**
- [CommonHelper.cs](file://PdfHelperLibrary/CommonHelper.cs#L11-L27)
- [PdfTextExtracter.cs](file://PdfTool/PdfTextExtracter.cs#L37-L38)
- [PdfTableExtracter.cs](file://PdfTool/PdfTableExtracter.cs#L38-L39)

### 日志检查步骤
1. **查看日志输出**：在每个功能模块的界面中，查看日志文本框中的输出信息。
2. **识别错误信息**：查找包含“失败”、“错误”或“异常”的日志条目。
3. **记录错误详情**：记下错误信息的具体内容，包括文件名、错误类型和错误消息。

**Section sources**
- [PdfRepairer.cs](file://PdfTool/PdfRepairer.cs#L65-L68)
- [PdfMerger.cs](file://PdfTool/PdfMerger.cs#L69-L70)
- [PdfSplitter.cs](file://PdfTool/PdfSplitter.cs#L63-L64)

## 配置文件验证

### 配置文件结构
`Config.cs`文件中定义了一些常量，用于控制界面元素的布局和间距。

**配置文件示例：**
```csharp
internal static class Config
{
    internal const int ControlMargin = 20;
    internal const int ControlPadding = 12;
}
```

**Section sources**
- [Config.cs](file://PdfTool/Config.cs#L3-L7)

### 配置文件验证步骤
1. **检查配置文件路径**：确保`Config.cs`文件位于正确的目录中。
2. **验证配置值**：确认`ControlMargin`和`ControlPadding`等常量的值是否合理。
3. **重新编译项目**：如果修改了配置文件，重新编译项目以确保更改生效。

**Section sources**
- [Config.cs](file://PdfTool/Config.cs#L3-L7)
- [MainForm.cs](file://PdfTool/MainForm.cs#L88-L91)

## 错误代码详解

### 常见错误代码
1. **文件不存在**：`FileNotFoundException`
   - **原因**：指定的文件路径不存在。
   - **解决方案**：检查文件路径，确保文件存在。

2. **文件读取失败**：`IOException`
   - **原因**：文件被其他程序占用或权限不足。
   - **解决方案**：关闭占用文件的程序，或以管理员身份运行工具。

3. **PDF解析失败**：`PdfReaderException`
   - **原因**：PDF文件损坏或格式不正确。
   - **解决方案**：使用PDF修复器尝试修复文件。

4. **参数无效**：`ArgumentException`
   - **原因**：传递给方法的参数不合法。
   - **解决方案**：检查参数值，确保符合方法要求。

**Section sources**
- [CommonHelper.cs](file://PdfHelperLibrary/CommonHelper.cs#L18-L24)
- [TableSplitHelper4Csv.cs](file://ExcelTool/Helpers/TableSplitHelper4Csv.cs#L16-L19)
- [TableSplitHelper4Excel.cs](file://ExcelTool/Helpers/TableSplitHelper4Excel.cs#L17-L20)

## 修复步骤指南

### 修复PDF文件
1. **打开PDF修复器**：在主界面中选择“PDF修复”选项卡。
2. **添加文件**：点击“打开文件并修复”按钮，选择需要修复的PDF文件。
3. **查看日志**：在日志文本框中查看修复过程和结果。
4. **验证修复结果**：尝试打开修复后的文件，确认问题是否解决。

**Section sources**
- [PdfRepairer.cs](file://PdfTool/PdfRepairer.cs#L74-L79)
- [PdfRepairer.cs](file://PdfTool/PdfRepairer.cs#L34-L55)

### 修复表格提取问题
1. **检查源文件**：确保PDF中的表格结构清晰，没有复杂的布局。
2. **调整提取参数**：在“PDF表格提取器”中，尝试不同的提取模式或参数。
3. **手动校正**：对于复杂表格，手动校正提取结果。

**Section sources**
- [PdfTableExtracter.cs](file://PdfTool/PdfTableExtracter.cs#L63-L85)
- [TableExtractHelper.cs](file://PdfHelperLibrary/TableExtractHelper.cs#L50-L70)

### 修复中文乱码问题
1. **检查编码设置**：确保工具使用的文本编码支持中文字符。
2. **更新字体**：确保系统中安装了支持中文的字体。
3. **使用正确的提取方法**：确保使用支持中文字符的提取方法。

**Section sources**
- [TextExtractHelper.cs](file://PdfHelperLibrary/TextExtractHelper.cs#L11-L32)
- [PdfTextExtracter.cs](file://PdfTool/PdfTextExtracter.cs#L62-L64)

## 附录

### 工具链接
- **问题和需求反馈**：[点击这里](https://www.yuque.com/lengda/eq8cm6/ezwik4)
- **使用说明**：[点击这里](https://www.yuque.com/lengda/eq8cm6/fgfthhr3e53qkszl)
- **赞赏支持**：[点击这里](https://www.yuque.com/lengda/eq8cm6/rylia4)

### 参考资料
- [PDFSharp官方文档](https://github.com/empira/PDFsharp)
- [UglyToad.PdfPig官方文档](https://github.com/UglyToad/PdfPig)
- [Tabula官方文档](https://github.com/tabulapdf/tabula)